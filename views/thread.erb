<h2><%= forum_name[@thread[:fid]] %></h2>

<div class=thread>
    <p class=nav>
    <a href="<%= u('forum', @thread[:fid]) %>" accesskey=u>목록</a>
    <a href="<%= u('thread', @thread[:tid], 'prev') %>" accesskey=p>이전</a>
    <a href="<%= u('thread', @thread[:tid], 'next') %>" accesskey=n>다음</a>
    </p>

    <h3><%= h(@thread[:subject]) %></h3>

	<p class=info>
		<span class=author><small><%= '%02d' % @thread[:year] %></small><%= h(@thread[:name]) %></span>
		<span class=date><%= formattime(@thread[:created]) %></span>
        <% if @thread[:uid] == session[:uid] %> &mdash;
            <a href="<%= u('edit_thread', @thread[:tid]) %>" accesskey="e">수정</a> ·
            <a href="<%= u('delete_thread', @thread[:tid]) %>" onclick="return confirm('아 정말요?')">삭제</a>
        <% end %>
	</p>
	<% if @size %>
		<blockquote class=attachment>
			<a href="<%= u('attachment', @thread[:tid], @thread[:attachment]) %>"><%= h(@thread[:attachment]) %></a> <small>(<%= number_format(@size >> 10) %>KB)</small><br>
            <% if @path =~ /\.(jpe?g|gif|png|bmp)$/i %>
                <img src="<%= u('attachment', @thread[:tid], @thread[:attachment]) %>" alt="<%= h(@thread[:attachment]) %>">
            <% end %>
		</blockquote>
	<% end %>
	<div class="article"><p><%= formattext(@thread[:message]) %></p></div>
	<p class="remark"><strong><%= '%02d' % @thread[:year] %><%= h(@thread[:name]) %></strong>
<%   if @thread[:phone] %>☎ <%= formatphone(@thread[:phone]) %><br><% end;
		if @thread[:email] %><a href="mailto:<%= h(@thread[:email]) %>"><%= h(@thread[:email]) %></a><br><% end %><%= formattext(@thread[:remark]) %></p>

<h4>“...!”</h4>
<dl>
<%
n = @messages.size
namemap = {
    '김효승' => '김효승이<sup>UTF-8</sup>',
    '구종만' => %q[<a href="http://www.yutar.net/thread/6570" style="font-family:Arial Narrow,Arial,sans-serif;font-stretch:condensed;font-weight:400"> Koo's open mind</a>],
}
@messages.each_with_index do |m,index|
    m[:message].gsub! /^(1{3,})(?=\s)/m, %Q[<a href="#" onclick="return follow1s('#{index}','\\1')">\\1</a>]
%>
<dt class=info>
    <span class=author><small><%= '%02d' % m[:year] %></small><%= namemap[m[:name]] || h(m[:name]) %></span>
    <span class=date><%= formattime(m[:created]) %></span>
    <% if session[:uid] == m[:uid] %>
    <a class=hid href="<%= u('delete_message', m[:mid]) %>" onclick="return validate(this)"><em>삭제</em></a>
    <% else %>
    <a class=hid href=# onclick="return add1s(<%= n - index %>)">답글1</a>
    <% end %>
</dt>
<dd id="comment<%= index %>" class=article><p><%= replace_emoticons(formattext(m[:message])) %></p></dd>
<% end %>

<dt class=info>
    <span class=author><small><%= '%02d' % session[:year] %></small><%= h(session[:name]) %></span>
    <span class=date>지금</span>
<dd>
    <form name=comment method=post action="<%= u('message') %>">
        <input type=hidden name=tid value="<%= @thread[:tid] %>">
        <p><textarea name=message cols=40 rows=5 accesskey=m placeholder="댓글 쓰기" onfocus="this.form.className='lazyinit';scrollBy(0,999)"></textarea></p>
        <p class=lazy><small>&lt;tex&gt;\code&lt;/tex&gt;</small></p>
        <p class=lazy><input type=submit accesskey=s value="쓰기"></p>
    </form>
</dl>

</div>
