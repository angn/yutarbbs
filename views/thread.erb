<h2><%= forum_name[@thread.fid] %></h2>

<div class=thread>
    <p class=nav>
    <a href="<%= u('forum', @thread.fid) %>" accesskey=u>목록</a>
    <a href="<%= u('thread', @thread.id, 'prev') %>" accesskey=p>이전</a>
    <a href="<%= u('thread', @thread.id, 'next') %>" accesskey=n>다음</a>
    </p>

    <h3><%= h(@thread.subject) %></h3>

	<p class=info>
		<span class=author><small><%= '%02d' % @thread.user.year %></small><%= h(@thread.user.name) %></span>
		<span class=date><%= formattime(@thread.created_at.to_time) %></span>
        <% if @thread.uid == session[:id] %> &mdash;
            <a href="<%= u('edit_thread', @thread.id) %>" accesskey="e">수정</a> ·
            <a href="<%= u('delete_thread', @thread.id) %>" onclick="return confirm('아 정말요?')">삭제</a>
        <% end %>
	</p>
	<% if @size %>
		<blockquote class=attachment>
			<a href="<%= u('attachment', @thread.id, @thread.attachment) %>"><%= h(@thread.attachment) %></a> <small>(<%= number_format(@size >> 10) %>KB)</small><br>
            <% if @thread.attachment =~ /\.(jpe?g|gif|png|bmp)$/i %>
                <img src="<%= u('attachment', @thread.id, @thread.attachment) %>" alt="<%= h(@thread.attachment) %>">
            <% end %>
		</blockquote>
	<% end %>
	<div class="article"><p><%= formattext(@thread.message) %></p></div>
	<p class="remark"><strong><%= '%02d' % @thread.user.year %><%= h(@thread.user.name) %></strong>
<%   if @thread.user.phone %>☎ <%= formatphone(@thread.user.phone) %><br><% end;
		if @thread.user.email %><a href="mailto:<%= h(@thread.user.email) %>"><%= h(@thread.user.email) %></a><br><% end %><%= formattext(@thread.user.remark) %></p>

<h4>“...!”</h4>
<dl>
<%
namemap = {
    '김효승' => '김효승이<sup>UTF-8</sup>',
    '구종만' => %q[<a href="http://www.yutar.net/thread/6570" style="font-family:Arial Narrow,Arial,sans-serif;font-stretch:condensed;font-weight:400"> Koo's open mind</a>],
}
(messages = @thread.messages).each_with_index do |message, index|
    message.message.gsub! /^(1{3,})(?=\s)/m, %Q[<a href="#" onclick="return follow1s('#{index}','\\1')">\\1</a>]
%>
<dt class=info>
    <span class=author><small><%= '%02d' % message.user.year %></small><%= namemap[message.user.name] || h(message.user.name) %></span>
    <span class=date><%= formattime(message.created_at.to_time) %></span>
    <% if session[:id] == message.uid %>
    <a class=hid href="<%= u('delete_message', message.id) %>" onclick="return validate(this)"><em>삭제</em></a>
    <% else %>
    <a class=hid href=# onclick="return add1s(<%= messages.size - index %>)">답글1</a>
    <% end %>
</dt>
<dd id="comment<%= index %>" class=article><p><%= replace_emoticons(formattext(message.message)) %></p></dd>
<% end %>

<dt class=info>
    <span class=author><small><%= '%02d' % session[:year] %></small><%= h(session[:name]) %></span>
    <span class=date>지금</span>
<dd>
    <form name=comment method=post action="<%= u('message') %>">
        <input type=hidden name=tid value="<%= @thread.id %>">
        <p><textarea name=message cols=40 rows=5 accesskey=m placeholder="댓글 쓰기" onfocus="this.form.className='lazyinit';scrollBy(0,999)"></textarea></p>
        <p class=lazy><small>&lt;tex&gt;\code&lt;/tex&gt;</small></p>
        <p class=lazy><input type=submit accesskey=s value="쓰기"></p>
    </form>
</dl>

</div>
